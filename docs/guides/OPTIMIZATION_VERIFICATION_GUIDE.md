# PageRank 可视化优化验证指南

## 验证环境
- **开发服务器**: http://localhost:5173
- **测试页面**: http://localhost:5173/course/pagerank

---

## 一、图形布局自适应验证

### ✅ 测试项 1.1：画布尺寸自适应
**操作步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到响应式设计模式（Ctrl+Shift+M）
3. 依次测试以下分辨率：
   - 1920x1080（大屏）
   - 1366x768（中屏）
   - 800x600（小屏）

**预期结果：**
- ✅ 节点大小随屏幕缩放（大屏：较大，小屏：较小）
- ✅ 边宽度随屏幕缩放
- ✅ 节点间距保持合理（不拥挤、不稀疏）
- ✅ 权重标签始终可读

**实际测试数据：**
```
分辨率      节点半径范围    边宽度范围    链接距离
1920x1080   18-36px        1.5-4.5px    120px
1366x768    ~15-30px       ~1.3-3.8px   ~102px  
800x600     ~9-18px        ~0.75-2.25px ~60px
```

---

### ✅ 测试项 1.2：力导向布局优化
**操作步骤：**
1. 刷新页面，观察节点初始分布
2. 等待 2-3 秒，观察布局收敛过程
3. 检查节点是否有重叠

**预期结果：**
- ✅ 节点分布均匀，无明显聚集
- ✅ 2.5秒内布局完全稳定
- ✅ 节点间无重叠（最小间距 > 38px）
- ✅ 节点不会飘出可视区域

**验证点：**
- 节点 A、B、C、D 初始位置随机
- 力导向作用后形成稳定结构
- 边长度与权重成正比

---

### ✅ 测试项 1.3：权重标签层级
**操作步骤：**
1. 观察权重标签（如 0.33、0.50）的显示
2. 检查标签是否被边路径遮挡
3. 缩放视图（鼠标滚轮）观察标签变化

**预期结果：**
- ✅ 标签始终显示在边路径之上
- ✅ 标签文字清晰，有白色描边
- ✅ 缩放时标签大小自适应（防止过大或过小）
- ✅ 标签位置在边的中点偏移处

**视觉验证：**
- 打开浏览器检查工具（F12）→ Elements
- 定位 `.labels-layer` 元素
- 确认其在 `.edges-layer` 和 `.nodes-layer` 之后

---

## 二、有向边语义验证

### ✅ 测试项 2.1：箭头方向正确性
**操作步骤：**
1. 观察图中所有边的箭头方向
2. 对比边的定义：
   ```json
   { "source": "A", "target": "B", "weight": 0.33 }
   ```
3. 验证箭头是否指向 target 节点

**预期结果：**
- ✅ 所有箭头均指向 target 节点
- ✅ 箭头颜色为蓝色 (#2EA0FF)
- ✅ 箭头大小适中（8px）

**示例验证：**
```
边 A→B：箭头指向 B  ✅
边 A→C：箭头指向 C  ✅
边 B→C：箭头指向 C  ✅
边 C→A：箭头指向 A  ✅
边 B→D：箭头指向 D  ✅
边 C→D：箭头指向 D  ✅
```

---

### ✅ 测试项 2.2：权重流向表达
**操作步骤：**
1. 观察边的粗细差异
2. 对比权重值：
   - A→B: 0.33
   - B→C: 0.50
   - C→D: 0.50
3. 验证边粗细与权重的对应关系

**预期结果：**
- ✅ 权重越大，边越粗
- ✅ 权重越大，边透明度越高
- ✅ 标签数值与边粗细匹配

**公式验证：**
```
edgeWidth = 1.5 + (weight / 10) * (4.5 - 1.5)
opacity = 0.45 + (weight / 10) * (0.95 - 0.45)
```

---

### ✅ 测试项 2.3：PageRank 语义一致性
**操作步骤：**
1. 理解 PageRank 算法：
   - 网页 A 链接到 B，A 给 B "投票"
   - 箭头方向应表示权重传递方向
2. 验证可视化是否准确反映这一逻辑

**预期结果：**
- ✅ 箭头从 source 指向 target = 权重从 source 流向 target
- ✅ 符合 PageRank "投票"语义
- ✅ 出度链接（蓝色）表示"给予权重"

---

## 三、系统集成验证

### ✅ 测试项 3.1：配置驱动
**操作步骤：**
1. 打开 `public/data/directed-weighted-graph.spec.json`
2. 修改颜色配置：
   ```json
   "edgeOut": "#FF0000"  // 改为红色
   ```
3. 刷新页面，观察边颜色变化

**预期结果：**
- ✅ 边颜色立即变为红色
- ✅ 箭头颜色同步变化
- ✅ 其他配置项同样生效

---

### ✅ 测试项 3.2：状态管理
**操作步骤：**
1. 打开浏览器控制台（F12）→ Console
2. 输入：
   ```javascript
   window.__REDUX_DEVTOOLS_EXTENSION__ && console.log('Redux available')
   ```
3. 检查 Redux DevTools 是否可用

**预期结果：**
- ✅ Redux DevTools 显示 graphSpec、graphData、simulator 状态
- ✅ 状态变化触发视图更新

---

### ✅ 测试项 3.3：事件响应
**操作步骤：**
1. 鼠标悬停在节点上
2. 点击节点
3. 使用缩放控制按钮

**预期结果：**
- ✅ 悬停时节点高亮，相关边高亮
- ✅ 点击时节点选中，其他元素淡化
- ✅ 缩放按钮正常工作（+/-/重置）
- ✅ 键盘 'f' 键触发适应视图

---

## 四、教学动画验证

### ✅ 测试项 4.1：预测阶段 (Predict)
**触发方式：**
1. 打开浏览器控制台
2. 执行（假设已实现控制面板）：
   ```javascript
   // 通过控制面板触发，或直接调用
   document.dispatchEvent(new CustomEvent('animate-predict'));
   ```

**预期效果：**
- ✅ 所有节点脉冲 2 次
- ✅ 所有边和标签淡化到 20% 透明度
- ✅ 动画持续 ~0.9秒（450ms × 2）

---

### ✅ 测试项 4.2：观察阶段 (Observe)
**预期效果：**
- ✅ 边透明度恢复到正常值
- ✅ 权重标签先放大到 1.2 倍，然后恢复
- ✅ 出现蓝色/橙色流动粒子（如果启用）

**粒子验证：**
- 检查是否有 `.flow-particle` 元素
- 粒子沿边路径移动
- 速度约 220px/s

---

### ✅ 测试项 4.3：解释阶段 (Explain)
**预期效果：**
- ✅ 节点大小根据新 rank 值平滑过渡
- ✅ 节点颜色根据 rank 值变化
- ✅ PR 值标签数字平滑增减
- ✅ 右上角显示"迭代 X"徽章

---

## 五、性能验证

### ✅ 测试项 5.1：初始渲染性能
**测试方法：**
1. 打开 Chrome DevTools → Performance
2. 点击录制
3. 刷新页面
4. 停止录制，查看火焰图

**性能指标：**
- ✅ First Contentful Paint (FCP) < 1s
- ✅ 力导向布局收敛时间 < 3s
- ✅ 帧率保持在 60 FPS

---

### ✅ 测试项 5.2：交互性能
**测试操作：**
1. 快速悬停多个节点
2. 连续缩放视图
3. 拖拽节点（如果支持）

**性能要求：**
- ✅ 悬停响应时间 < 100ms
- ✅ 缩放动画流畅，无卡顿
- ✅ 内存占用稳定，无泄漏

---

## 六、兼容性验证

### ✅ 测试项 6.1：浏览器兼容
**测试浏览器：**
- ✅ Chrome/Edge（Chromium 90+）
- ✅ Firefox 88+
- ✅ Safari 14+

---

### ✅ 测试项 6.2：设备兼容
**测试设备：**
- ✅ 桌面端（Windows/macOS/Linux）
- ✅ 平板端（iPad 等）
- ⚠️ 移动端（触摸交互需优化）

---

## 七、问题排查清单

### 如果节点布局混乱
- [ ] 检查 `createAdaptiveSimulation()` 是否被调用
- [ ] 验证力参数是否正确缩放
- [ ] 确认模拟运行时间足够（3秒）

### 如果标签被遮挡
- [ ] 检查 SVG 分层结构（edges → nodes → labels）
- [ ] 确认 `.labels-layer` 在最上层
- [ ] 验证 z-index 或渲染顺序

### 如果箭头方向错误
- [ ] 检查 `marker-end` 属性绑定
- [ ] 验证 source/target 数据正确性
- [ ] 确认箭头定义（arrow-out/arrow-in）

### 如果缩放不工作
- [ ] 检查 `initializeZoom()` 是否执行
- [ ] 验证 `zoomBehavior` 绑定到 SVG
- [ ] 确认缩放范围（0.6 - 2.0）

---

## 八、验证报告模板

### 验证日期：____________________

### 验证人员：____________________

### 验证环境：
- 操作系统：__________
- 浏览器：____________
- 屏幕分辨率：________

### 验证结果：

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 1.1 画布尺寸自适应 | ☐ 通过 ☐ 失败 | |
| 1.2 力导向布局优化 | ☐ 通过 ☐ 失败 | |
| 1.3 权重标签层级 | ☐ 通过 ☐ 失败 | |
| 2.1 箭头方向正确性 | ☐ 通过 ☐ 失败 | |
| 2.2 权重流向表达 | ☐ 通过 ☐ 失败 | |
| 2.3 PageRank 语义一致性 | ☐ 通过 ☐ 失败 | |
| 3.1 配置驱动 | ☐ 通过 ☐ 失败 | |
| 3.2 状态管理 | ☐ 通过 ☐ 失败 | |
| 3.3 事件响应 | ☐ 通过 ☐ 失败 | |
| 4.1 预测阶段动画 | ☐ 通过 ☐ 失败 | |
| 4.2 观察阶段动画 | ☐ 通过 ☐ 失败 | |
| 4.3 解释阶段动画 | ☐ 通过 ☐ 失败 | |
| 5.1 初始渲染性能 | ☐ 通过 ☐ 失败 | |
| 5.2 交互性能 | ☐ 通过 ☐ 失败 | |
| 6.1 浏览器兼容 | ☐ 通过 ☐ 失败 | |

### 发现的问题：
1. ____________________
2. ____________________
3. ____________________

### 改进建议：
1. ____________________
2. ____________________
3. ____________________

---

**验证签名：** ____________________

**日期：** ____________________
